SQLにおける置換変数（Substitution Variables）は、SQLスクリプトを実行する際に、ユーザーからの入力を受け取って、その値をクエリ内で使用するための機能です。特に、Oracle SQL*PlusやSQL Developerのようなツールで使われることが多いです。置換変数を使うと、クエリの実行時に動的に値を指定できるため、汎用的なSQLスクリプトを作成することが可能です。

### 1. 置換変数の基本的な使い方

置換変数は、通常 `&` または `&&` の記号を使って定義します。`&` は一時的な置換変数で、スクリプトの中で再利用されません。`&&` は永続的な置換変数で、一度指定するとスクリプト内で再利用されます。

#### 1.1 一時的な置換変数（`&`）

```sql
SELECT * FROM employees WHERE department_id = &dept_id;
```

- **動作**: このクエリを実行すると、SQL*PlusやSQL Developerは `dept_id` の値をユーザーに尋ねます。ユーザーが入力した値で `&dept_id` が置換され、クエリが実行されます。
- **例**: ユーザーが `10` を入力すると、以下のようなクエリが実行されます。
  ```sql
  SELECT * FROM employees WHERE department_id = 10;
  ```

#### 1.2 永続的な置換変数（`&&`）

```sql
SELECT * FROM employees WHERE department_id = &&dept_id;
```

- **動作**: `&&` を使用すると、最初に値を入力した後、同じセッション内でその値が再利用されます。再度クエリが実行された場合でも、同じ値が使用されます。
- **例**: 最初に `dept_id` に `20` を指定すると、その後のクエリでも `20` が使用されます。

### 2. 置換変数の応用

#### 2.1 複数の置換変数を使用する

```sql
SELECT * FROM employees WHERE department_id = &dept_id AND job_id = '&job_id';
```

- **動作**: このクエリでは、ユーザーが2つの値を入力します。`department_id` と `job_id` の両方に対して動的に条件を指定できます。
- **例**: ユーザーが `10` を `dept_id` に、`IT_PROG` を `job_id` に入力すると、以下のクエリが実行されます。
  ```sql
  SELECT * FROM employees WHERE department_id = 10 AND job_id = 'IT_PROG';
  ```

#### 2.2 `DEFINE` コマンドを使った変数の定義

`DEFINE` コマンドを使って変数を事前に定義することもできます。これにより、ユーザーに値を尋ねることなく、変数に値を設定できます。

```sql
DEFINE dept_id = 30
SELECT * FROM employees WHERE department_id = &dept_id;
```

- **動作**: この場合、`dept_id` に `30` が設定されているため、クエリ実行時に値を入力する必要はありません。

### 3. 置換変数のクリア

置換変数をクリアして再設定したい場合は、`UNDEFINE` コマンドを使用します。

```sql
UNDEFINE dept_id
```

- **動作**: `dept_id` の変数がクリアされ、次回実行時に再度値を尋ねられます。

### 4. 置換変数の注意点

- **SQLインジェクションのリスク**: 置換変数にユーザー入力を直接使うと、SQLインジェクションのリスクがあるため、特にWebアプリケーションなどでは慎重に扱う必要があります。
- **データ型の扱い**: 置換変数の値が文字列の場合、クエリ内でシングルクォーテーションで囲む必要があります。そうでないと、エラーになることがあります。

### まとめ

置換変数は、SQLスクリプトをより柔軟かつ動的にするために非常に便利な機能です。特に同じクエリを異なる条件で繰り返し実行する場合や、複数のユーザーからの入力を処理する場合に役立ちます。ただし、使用する際にはセキュリティ上の注意が必要です。

何か他に質問があれば、どうぞお知らせください！
