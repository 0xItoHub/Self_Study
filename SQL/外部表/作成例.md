'''
CREATE TABLE customers_ext
ORGANIZATION EXTERNAL
(
TYPE ORACLE_DATAPUMP
DEFAULT DIRECTORY ext_dir
LOCATION ('customers_ext.dmp')
)
AS SELECT * FROM customers;
'''

このSQL文は、Oracleデータベースにおいて、`customers` テーブルの内容を外部表としてエクスポートし、そのデータを `customers_ext` という新しい外部表として作成するものです。`ORACLE_DATAPUMP` 形式を使って、`customers` テーブルのデータをデータポンプファイルにエクスポートし、そのデータポンプファイルを参照する外部表を定義しています。

### SQL文の構成

1. **`CREATE TABLE customers_ext`**:
   - `customers_ext` という新しいテーブルを作成します。ただし、このテーブルは通常のデータベース内のテーブルではなく、**外部表（External Table）**です。
   
2. **`ORGANIZATION EXTERNAL`**:
   - この句は、作成するテーブルが外部表であることを指定します。外部表はデータベース外部に保存されているデータを参照するため、通常のテーブルとは異なります。

3. **`TYPE ORACLE_DATAPUMP`**:
   - **`ORACLE_DATAPUMP`** は、データポンプ形式のファイルを扱うためのアクセスドライバです。この指定により、外部表はデータポンプ形式のファイルを使用してデータを管理します。
   - データポンプファイルはバイナリ形式のファイルで、Oracleデータベースのエクスポートおよびインポートに使用されます。

4. **`DEFAULT DIRECTORY ext_dir`**:
   - **`ext_dir`** というディレクトリオブジェクトが使用されます。このディレクトリオブジェクトは、データベース内で事前に定義されている必要があり、ファイルシステム上のディレクトリにマッピングされています。
   - データポンプファイル（この場合、`customers_ext.dmp`）はこのディレクトリに保存されます。

5. **`LOCATION ('customers_ext.dmp')`**:
   - これは、データポンプファイルの名前を指定します。この場合、ファイル名は `customers_ext.dmp` で、`ext_dir` ディレクトリに保存されます。
   - このファイルには `customers` テーブルのデータが保存され、外部表 `customers_ext` を通してアクセスされます。

6. **`AS SELECT * FROM customers`**:
   - `customers` テーブルからすべてのデータを選択し、そのデータをデータポンプファイルに書き出します。この操作によって、`customers_ext.dmp` ファイルが作成され、`customers` テーブルのデータがエクスポートされます。
   - この部分は、通常の `CREATE TABLE AS SELECT` の文に相当しますが、今回はデータベース内部ではなく外部のデータポンプファイルに書き出される点が異なります。

### 動作の流れ

1. **テーブル作成**:
   この文を実行すると、`customers_ext` という外部表が作成されますが、通常のテーブルとは異なり、データはデータベース内部には保存されません。データは指定されたディレクトリ (`ext_dir`) 内に、データポンプファイル (`customers_ext.dmp`) として保存されます。

2. **データのエクスポート**:
   `customers` テーブルから全データが抽出され、データポンプファイル (`customers_ext.dmp`) にエクスポートされます。このファイルはバイナリ形式で、通常のテキストファイルとは異なります。

3. **外部表の使用**:
   作成された `customers_ext` 外部表は、`customers_ext.dmp` ファイルを参照して動作します。この外部表に対してSQLクエリ（`SELECT`など）を実行すると、`customers_ext.dmp` ファイルからデータを読み取って結果を返します。ただし、このデータに対する`INSERT`や`UPDATE`、`DELETE`などの変更操作はできません。あくまで読み取り専用の外部表です。

### メリット

- **高速なデータエクスポート/インポート**: データポンプ形式は、Oracleデータベースのデータを高速にエクスポートおよびインポートするための標準形式です。外部表とデータポンプ形式を組み合わせることで、効率的なデータ移行が可能です。
  
- **ディスク容量の節約**: データベース内部にデータを保持せず、ファイルシステムにデータを保存するため、データベースのディスク使用量を抑えることができます。

- **大規模データの一時的な利用**: 大規模なデータを一時的に参照したい場合や、別のシステム間でデータをやり取りしたい場合に便利です。

### まとめ
このSQL文は、`customers` テーブルのデータをデータポンプ形式でエクスポートし、そのデータを外部表 `customers_ext` として使用できるようにするものです。これにより、データベース外部にデータを保存しつつ、SQLクエリでデータを参照することが可能になります。ただし、外部表は読み取り専用であり、データの変更は行えません。
